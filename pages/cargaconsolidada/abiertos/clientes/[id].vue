    <!--3 tabs:general,variacion,pagos and 3 tables-->
    <template>
        <div class="p-6">


            <DataTable v-if="tab === 'general'" title="" icon="" :data="clientes" :columns="getColumnsGeneral()"
                :loading="loadingGeneral" :current-page="currentPageGeneral" :total-pages="totalPagesGeneral"
                :total-records="totalRecordsGeneral" :items-per-page="itemsPerPageGeneral"
                :search-query-value="searchGeneral" :show-secondary-search="false" :show-filters="false"
                :filter-config="filtersGeneral" :show-export="(currentId == ID_JEFEVENTAS) ? true : false" :show-body-top="true"
                :show-pagination="false" @export="exportData"
                empty-state-message="No se encontraron registros de clientes."
                @update:primary-search="handleSearchGeneral" @page-change="handlePageGeneralChange"
                @items-per-page-change="handleItemsPerPageChangeGeneral" @filter-change="handleFilterChangeGeneral"
                :hide-back-button="false"
                :previous-page-url="(currentRole == ROLES.COORDINACION || currentId == ID_JEFEVENTAS || currentRole == ROLES.DOCUMENTACION) ? `/cargaconsolidada/abiertos/pasos/${id}` : `/cargaconsolidada/abiertos`">
                <template #body-top>
                    <div class="flex flex-col gap-2 w-full">
                        <SectionHeader :title="`Clientes #${carga}`" :headers="headers" :loading="loadingHeaders" />
                        <UTabs v-model="tab" :items="tabs" size="sm" variant="pill" class="mb-4 w-80 h-15"
                            color="neutral" />
                    </div>

                </template>
            </DataTable>
            <DataTable v-if="tab === 'variacion'" title="" icon="" :data="clientesVariacion" :columns="columnsVariacion"
                :loading="loadingVariacion" :current-page="currentPageVariacion" :total-pages="totalPagesVariacion"
                :total-records="totalRecordsVariacion" :items-per-page="itemsPerPageVariacion"
                :search-query-value="searchVariacion" :show-secondary-search="false" :show-filters="false"
                :filter-config="filtersVariacion" :show-export="false" :show-body-top="true"
                :hide-back-button="false"
                :show-pagination="false" @export="exportData"

                :previous-page-url="(currentRole == ROLES.COORDINACION || currentId == ID_JEFEVENTAS || currentRole == ROLES.DOCUMENTACION) ? `/cargaconsolidada/abiertos/pasos/${id}` : `/cargaconsolidada/abiertos`"
                empty-state-message="No se encontraron registros de clientes."
                @update:primary-search="handleSearchVariacion" @page-change="handlePageVariacionChange"
                @items-per-page-change="handleItemsPerPageChangeVariacion" @filter-change="handleFilterChangeVariacion">
                <template #body-top>
                    <div class="flex flex-col gap-2 w-full">
                        <SectionHeader :title="`Clientes #${carga}`" :headers="headers" :loading="loadingHeaders" />
                        <UTabs v-model="tab" :items="tabs" size="sm" variant="pill" class="mb-4 w-80 h-15"
                            color="neutral" />
                    </div>

                </template>
            </DataTable>
            <DataTable v-if="tab === 'pagos'" title="" icon="" :data="clientesPagos" :columns="columnsPagos"
                :loading="loadingPagos" :current-page="currentPagePagos" :total-pages="totalPagesPagos"
                :total-records="totalRecordsPagos" :items-per-page="itemsPerPagePagos"
                :search-query-value="searchPagos" :show-secondary-search="false" :show-filters="false"
                :filter-config="filtersPagos" :show-export="false" :hide-back-button="false"
                :show-body-top="true"
                :show-pagination="false" @export="exportData"

                :previous-page-url="(currentRole == ROLES.COORDINACION || currentId == ID_JEFEVENTAS) ? `/cargaconsolidada/abiertos/pasos/${id}` : `/cargaconsolidada/abiertos`"
                empty-state-message="No se encontraron registros de clientes."
                @update:primary-search="handleSearchVariacion" @page-change="handlePageVariacionChange"
                @items-per-page-change="handleItemsPerPageChangeVariacion" @filter-change="handleFilterChangeVariacion">
                <template #body-top>
                    <div class="flex flex-col gap-2 w-full">
                        <SectionHeader :title="`Contenedor #${carga}`" :headers="headers" :loading="loadingHeaders" />
                        <UTabs v-model="tab" :items="tabs" size="sm" variant="pill" class="mb-4 w-80 h-15"
                            color="neutral" />
                    </div>
                </template>
            </DataTable>
        </div>
    </template>
<script setup lang="ts">
import { useGeneral } from '~/composables/cargaconsolidada/clientes/useGeneral'
import { useVariacion } from '~/composables/cargaconsolidada/clientes/useVariacion'
import { usePagos } from '~/composables/cargaconsolidada/clientes/usePagos'
import { UButton, UBadge, USelect } from '#components'
import { useModal } from '~/composables/commons/useModal'
import { useSpinner } from '~/composables/commons/useSpinner'
import { ROLES, ID_JEFEVENTAS } from '~/constants/roles'
import { useUserRole } from '~/composables/auth/useUserRole'
import type { TableColumn } from '@nuxt/ui'
import PagoGrid from '~/components/PagoGrid.vue'
import { STATUS_BG_CLASSES, STATUS_BG_PAGOS_CLASSES } from '~/constants/ui'
import SectionHeader from '~/components/commons/SectionHeader.vue'
const { withSpinner } = useSpinner()
const { showConfirmation, showSuccess, showError } = useModal()
const { currentRole, currentId, isCoordinacion } = useUserRole()
const route = useRoute()
const id = route.params.id
const tab = ref('general')
const { getClientes, 
        clientes, 
        updateEstadoCliente, 
        totalRecordsGeneral, 
        loadingGeneral, 
        error, 
        paginationGeneral, 
        searchGeneral, 
        itemsPerPageGeneral, 
        totalPagesGeneral, 
        currentPageGeneral, 
        filtersGeneral, 
        handlePageGeneralChange, 
        handleItemsPerPageChangeGeneral, 
        handleFilterChangeGeneral, 
        handleSearchGeneral, 
        getHeaders, 
        headers, 
        carga, 
        loadingHeaders, 
        handleUpdateStatusClienteDoc,
        exportData: exportGeneralData } = useGeneral()
const { getClientesVariacion, 
        updateVolumenSelected, 
        clientesVariacion, 
        totalRecordsVariacion, 
        loadingVariacion, 
        paginationVariacion, 
        searchVariacion, 
        itemsPerPageVariacion, 
        totalPagesVariacion, 
        currentPageVariacion, 
        filtersVariacion, 
        handlePageVariacionChange, 
        handleItemsPerPageChangeVariacion, 
        handleFilterChangeVariacion, 
        handleSearchVariacion,
        exportData: exportVariacionData } = useVariacion()
const { getClientesPagos, 
        clientesPagos, 
        totalRecordsPagos, 
        loadingPagos, 
        paginationPagos, 
        searchPagos, 
        itemsPerPagePagos, 
        totalPagesPagos, 
        currentPagePagos, 
        filtersPagos, 
        handlePagePagosChange, 
        handleItemsPerPageChangePagos, 
        handleFilterChangePagos, 
        handleSearchPagos, 
        registrarPago, 
        deletePago,
        exportData: exportPagosData } = usePagos()
const tabs = ref()
const handleTabChange = (value: string) => {
    if (tab.value === 'general') {
        getClientes(Number(id))
    } else if (tab.value === 'variacion') {
        getClientesVariacion(Number(id))
    } else if (tab.value === 'pagos') {
        getClientesPagos(Number(id))
    }
}

const exportData = async () => {
  if (tab.value === 'general') {
    await exportGeneralData()
  } else if (tab.value === 'variacion') {
    await exportVariacionData()
  } else if (tab.value === 'pagos') {
    await exportPagosData()
  }
}


//N.	Nombre	DNI/RUC	Whatsapp	T. Cliente	Estado	Conceptop	Importe	Pagado	Adelantos
const columnsPagos = ref<TableColumn<any>[]>([
    {
        accessorKey: 'index',
        header: 'NÂ°',
        cell: ({ row }: { row: any }) => {
            return row.index + 1
        }
    },
    {
        accessorKey: 'nombre',
        header: 'Nombre',
        cell: ({ row }: { row: any }) => {
            return row.getValue('nombre').toUpperCase()
        }
    },
    {
        accessorKey: 'documento',
        header: 'DNI/RUC',
        cell: ({ row }: { row: any }) => {
            return row.getValue('documento')
        }
    },
    {
        accessorKey: 'telefono',
        header: 'Whatsapp',
        cell: ({ row }: { row: any }) => {
            return row.getValue('telefono')
        }
    },
    {
        accessorKey: 'name',
        header: 'T. Cliente',
        cell: ({ row }: { row: any }) => {
            return row.getValue('name')
        }
    },
    {
        accessorKey: 'estado',
        header: 'Estado',
        cell: ({ row }: { row: any }) => {
            return h(USelect as any, {
                modelValue: row.original.estado_pago,
                disabled: true,
                items: [
                    { label: 'PENDIENTE', value: 'PENDIENTE' },
                    { label: 'PAGADO', value: 'PAGADO' },
                    { label: 'ADELANTO', value: 'ADELANTO' },
                    { label: 'SOBREPAGO', value: 'SOBREPAGO' },
                ],
                class: STATUS_BG_PAGOS_CLASSES[row.original.estado_pago as keyof typeof STATUS_BG_PAGOS_CLASSES],

            })
        }
    },
    {
        accessorKey: 'concepto',
        header: 'Concepto',
        cell: ({ row }: { row: any }) => {
            return 'Logistica'
        }
    },
    {
        accessorKey: 'importe',
        header: 'Importe',
        cell: ({ row }: { row: any }) => {
            return formatCurrency(row.original.monto)
        }
    },
    {
        accessorKey: 'pagado',
        header: 'Pagado',
        cell: ({ row }: { row: any }) => {
            return formatCurrency(row.original.total_pagos)
        }
    },
    {
        accessorKey: 'adelantos',
        header: 'Adelantos',
        cell: ({ row }: { row: any }) => {
            const pagos = JSON.parse(row.original.pagos_details ?? '[]');
            return h(PagoGrid, {
                pagoDetails: pagos,
                currency: 'USD',
                numberOfPagos: currentRole.value == ROLES.COORDINACION ? 4 :pagos.length,
                clienteNombre: row.original.nombre,
                onSave: (data) => {
                    const formData = new FormData();
                    for (const key in data) {
                        if (data[key] !== undefined && data[key] !== null) {
                            formData.append(key, data[key]);
                        }
                    }
                    formData.append('idPedido', row.original.id_cotizacion)
                    formData.append('idContenedor', row.original.id_contenedor)
                    formData.append('idCotizacion', row.original.id_cotizacion)
                    withSpinner(async () => {
                        const response = await registrarPago(formData)
                        if (response.success) {
                            showSuccess('Pago registrado', 'Pago registrado correctamente', { duration: 3000 })
                            getClientesPagos(Number(id))
                        } else {
                            showError('Error al registrar pago', response.error, { persistent: true })
                        }
                    }, 'registrarPago')

                },
                onDelete: (pagoId: number) => {
                    showConfirmation(
                        'Confirmar eliminaciÃ³n',
                        'Â¿EstÃ¡ seguro de que desea eliminar el pago? Esta acciÃ³n no se puede deshacer.',
                        async () => {
                            try {
                                await withSpinner(async () => {
                                    const response = await deletePago(pagoId)
                                    if (response.success) {
                                        await getClientesPagos(Number(id))
                                        showSuccess('EliminaciÃ³n Exitosa', 'El pago se ha eliminado correctamente.')
                                        await getHeaders(Number(id))
                                    }
                                }, 'Eliminando pago...')
                            } catch (error) {
                                console.error('Error al eliminar el pago:', error)
                                showError('Error de EliminaciÃ³n', 'Error al eliminar el pago')
                            }
                        }
                    )
                },
                showDelete: currentRole.value == ROLES.COORDINACION,
            })
        }
    }
])
//NÂ° Fecha	Nombre	DNI/RUC	Correo	Whatsapp	T. Cliente	Volumen	Qty Item	Fob	Logistica	Impuesto	Tarifa	Estados	Status	Acciones
const columns: TableColumn<any>[] = [
    {
        accessorKey: 'index',
        header: 'NÂ°',
        cell: ({ row }: { row: any }) => {
            return row.index + 1
        }
    },

    {
        accessorKey: 'fecha',
        header: 'Fecha',
        cell: ({ row }: { row: any }) => {
            return formatDateTimeToDmy(row.getValue('fecha'))
        }
    },
    {
        accessorKey: 'nombre',
        header: 'Nombre',
        cell: ({ row }: { row: any }) => {
            const nombre = row.getValue('nombre').toUpperCase()
            return h('div', {
                class: 'max-w-30 whitespace-normal break-words',
            }, nombre)
        }
    },
    {
        accessorKey: 'documento',
        header: 'DNI/RUC',
        cell: ({ row }: { row: any }) => {
            return row.getValue('documento')
        }
    },

    {
        accessorKey: 'correo',
        header: 'Correo',
        cell: ({ row }: { row: any }) => {
            const correo = row.getValue('correo')
            return h('div', {
                class: 'max-w-40 whitespace-normal break-words',
            }, correo || 'Sin correo'
            )
        }
    },
    {
        accessorKey: 'telefono',
        header: 'Whatsapp',
        cell: ({ row }: { row: any }) => {
            return row.getValue('telefono')
        }
    },
    {
        accessorKey: 'name',
        header: 'T. Cliente',
        cell: ({ row }: { row: any }) => {
            return row.getValue('name')
        }
    },
    {
        accessorKey: 'volumen',
        header: 'Volumen',
        cell: ({ row }: { row: any }) => {
            return row.getValue('volumen')
        }
    },

    {
        accessorKey: 'qty_item',
        header: 'Qty Item',
        cell: ({ row }: { row: any }) => {
            return row.getValue('qty_item')
        }
    },
    {
        accessorKey: 'fob',
        header: 'Fob',
        cell: ({ row }: { row: any }) => {
            return formatCurrency(row.getValue('fob'))
        }
    },
    {
        accessorKey: 'monto',
        header: 'Logistica',
        cell: ({ row }: { row: any }) => {
            return formatCurrency(row.getValue('monto'))
        }
    },
    {
        accessorKey: 'impuestos',
        header: 'Impuesto',
        cell: ({ row }: { row: any }) => {
            return formatCurrency(row.getValue('impuestos'))
        }
    },
    {
        accessorKey: 'tarifa',
        header: 'Tarifa',
        cell: ({ row }: { row: any }) => {
            return formatCurrency(row.getValue('tarifa'))
        }
    },


    {
        accessorKey: 'acciones',
        header: 'Acciones',
        cell: ({ row }: { row: any }) => {
            //button view with more info
            return h(UButton, {
                icon: 'i-heroicons-eye',
                variant: 'ghost',
                size: 'xs',
                onClick: () => {
                    navigateTo(`/cargaconsolidada/abiertos/clientes/documentacion/${row.original.id_cotizacion}`)
                }
            },
            )
        }
    }
]
const columnsCoordinacion: TableColumn<any>[] = [
    {
        accessorKey: 'index',
        header: 'NÂ°',
        cell: ({ row }: { row: any }) => {
            return row.index + 1
        }
    },

    {
        accessorKey: 'fecha',
        header: 'Fecha',
        cell: ({ row }: { row: any }) => {
            return formatDateTimeToDmy(row.getValue('fecha'))
        }
    },
    {
        accessorKey: 'nombre',
        header: 'Nombre',
        cell: ({ row }: { row: any }) => {
            //todos en mayusculas
            return row.getValue('nombre').toUpperCase()
        }
    },
    {
        accessorKey: 'documento',
        header: 'DNI/RUC',
        cell: ({ row }: { row: any }) => {
            return row.getValue('documento')
        }
    },

    {
        accessorKey: 'correo',
        header: 'Correo',
        cell: ({ row }: { row: any }) => {
            return row.getValue('correo')
        }
    },
    {
        accessorKey: 'telefono',
        header: 'Whatsapp',
        cell: ({ row }: { row: any }) => {
            return row.getValue('telefono')
        }
    },
    {
        accessorKey: 'name',
        header: 'T. Cliente',
        cell: ({ row }: { row: any }) => {
            return row.getValue('name')
        }
    },
    {
        accessorKey: 'volumen',
        header: 'Volumen',
        cell: ({ row }: { row: any }) => {
            return row.getValue('volumen')
        }
    },

    {
        accessorKey: 'qty_item',
        header: 'Qty Item',
        cell: ({ row }: { row: any }) => {
            return row.getValue('qty_item')
        }
    },
    {
        accessorKey: 'fob',
        header: 'Fob',
        cell: ({ row }: { row: any }) => {
            return formatCurrency(row.getValue('fob'))
        }
    },
    {
        accessorKey: 'monto',
        header: 'Logistica',
        cell: ({ row }: { row: any }) => {
            return formatCurrency(row.getValue('monto'))
        }
    },
    {
        accessorKey: 'impuestos',
        header: 'Impuesto',
        cell: ({ row }: { row: any }) => {
            return formatCurrency(row.getValue('impuestos'))
        }
    },
    {
        accessorKey: 'tarifa',
        header: 'Tarifa',
        cell: ({ row }: { row: any }) => {
            return formatCurrency(row.getValue('tarifa'))
        }
    },
    {
        accessorKey: 'estados',
        header: 'Estados',
        cell: ({ row }: { row: any }) => {
            //show estado_cliente in USELECT WITH STATUS RESERVADO,NO RESERVADO DOCUMENTACION C FINAL FACTURADO
            return h(USelect as any, {
                //color status based on estado_cliente
                class: STATUS_BG_CLASSES[row.original.estado_cliente as keyof typeof STATUS_BG_CLASSES],
                modelValue: row.original.estado_cliente,
                items: [
                    { label: 'Reservado', value: 'RESERVADO' },
                    { label: 'No Reservado', value: 'NO RESERVADO' },
                    { label: 'DocumentaciÃ³n', value: 'DOCUMENTACION' },
                    { label: 'C Final', value: 'C FINAL' },
                    { label: 'Facturado', value: 'FACTURADO' }
                ],
                placeholder: 'Seleccionar estado',
                'onUpdate:modelValue': async (value: any) => {
                    if (value && value !== row.original.estado_cliente) {
                        const data = {
                            id_cotizacion: row.original.id_cotizacion,
                            estado_cliente: value
                        }
                        await handleUpdateEstadoCliente(data)
                    }
                }
            })
        }
    },

    {
        accessorKey: 'acciones',
        header: 'Acciones',
        cell: ({ row }: { row: any }) => {
            //button view with more info
            return h(UButton, {
                icon: 'i-heroicons-eye',
                variant: 'ghost',
                size: 'xs',
                onClick: () => {
                    navigateTo(`/cargaconsolidada/abiertos/clientes/documentacion/${row.original.id_cotizacion}`)
                }
            },
            )
        }
    }
]
//NÂ°	Nombre	DNI/RUC	Correo	Whatsapp	T. Cliente	Status	Accio
const columnsDocumentacion: TableColumn<any>[] = [
    {
        accessorKey: 'index',
        header: 'NÂ°',
        cell: ({ row }: { row: any }) => {
            return row.index + 1
        }
    },
    {
        accessorKey: 'nombre',
        header: 'Nombre',
        cell: ({ row }: { row: any }) => {
            return row.getValue('nombre')
        }
    },
    {
        accessorKey: 'documento',
        header: 'DNI/RUC',
        cell: ({ row }: { row: any }) => {
            return row.getValue('documento')
        }
    },
    {
        accessorKey: 'correo',
        header: 'Correo',
        cell: ({ row }: { row: any }) => {
            return row.getValue('correo')
        }
    },
    {
        accessorKey: 'telefono',
        header: 'Whatsapp',
        cell: ({ row }: { row: any }) => {
            return row.getValue('telefono')
        }
    },
    {
        accessorKey: 'name',
        header: 'T. Cliente',
        cell: ({ row }: { row: any }) => {
            return row.getValue('name')
        }
    }, {
        accessorKey: 'status',
        header: 'Status',
        cell: ({ row }: { row: any }) => {
            return h(USelect as any, {
                label: row.original.status_cliente_doc,
                class: STATUS_BG_CLASSES[row.original.status_cliente_doc as keyof typeof STATUS_BG_CLASSES],
                variant: 'soft',
                modelValue: row.original.status_cliente_doc,
                items: [
                    { label: 'COMPLETADO', value: 'Completado' },
                    { label: 'PENDIENTE', value: 'Pendiente' },
                    { label: 'INCOMPLETO', value: 'Incompleto' }
                ],
                'onUpdate:modelValue': async (value: any) => {
                    if (value && value !== row.original.status_cliente_doc) {
                        await withSpinner(async () => {
                            const data = {
                                id_cotizacion: row.original.id_cotizacion,
                                status_cliente_doc: value

                            }
                            const response = await handleUpdateStatusClienteDoc(data)
                            if (response.success) {
                                await getClientes(Number(id))
                                showSuccess('ActualizaciÃ³n Exitosa', 'El estado de la documentaciÃ³n del cliente se ha actualizado correctamente.')
                            }
                        }, 'Actualizando estado de la documentaciÃ³n del cliente...')
                    }
                }
            })
        }
    },
    {
        accessorKey: 'acciones',
        header: 'Acciones',
        cell: ({ row }: { row: any }) => {
            return h(UButton, {
                icon: 'i-heroicons-eye',
                variant: 'ghost',
                size: 'xs',
                onClick: () => {
                    navigateTo(`/cargaconsolidada/abiertos/clientes/documentacion/${row.original.id_cotizacion}`)
                }
            })
        }
    }
]
const getColumnsGeneral = () => {
    switch (currentRole.value) {
        case ROLES.DOCUMENTACION:
            return columnsDocumentacion
        case ROLES.COORDINACION:
            return columnsCoordinacion
        default:
            return columns
    }
}
const getColorStatusDocumentacion = (status: string) => {
    //Completado,Pendiente,Incompleto
    switch (status) {
        case 'Completado':
            return 'primary'
        case 'Pendiente':
            return 'warning'
        case 'Incompleto':
            return 'error'
    }
    return 'neutral'
}
const columnsVariacion = ref<TableColumn<any>[]>([
    {
        accessorKey: 'index',
        header: 'NÂ°',
        cell: ({ row }: { row: any }) => {
            return row.index + 1
        }
    },
    {
        accessorKey: 'asesor',
        header: 'Asesor',
        cell: ({ row }: { row: any }) => {
            return row.getValue('asesor')
        }
    },
    {
        accessorKey: 'nombre',
        header: 'Nombre',
        cell: ({ row }: { row: any }) => {
            return row.getValue('nombre')
        }
    },
    {
        accessorKey: 'documento',
        header: 'DNI/RUC',
        cell: ({ row }: { row: any }) => {
            return row.getValue('documento')
        }
    },
    {
        accessorKey: 'name',
        header: 'T. Cliente',
        cell: ({ row }: { row: any }) => {
            return row.getValue('name')
        }
    },
    {
        accessorKey: 'tarifa',
        header: 'Tarifa',
        cell: ({ row }: { row: any }) => {
            return row.getValue('tarifa')
        }
    },
    {
        accessorKey: 'volumen',
        header: 'Vol. Cot',
        cell: ({ row }: { row: any }) => {
            //RETURN UBADGET WITH COLOR PRIMARY WHERE vol_selected is = accessorKey
            return h(UBadge, {
                color: row.original.vol_selected === 'volumen' ? 'primary' : 'transparent',
                variant: 'solid',
                class: 'cursor-pointer text-black dark:text-white p-4',
                label: row.getValue('volumen'),
                onClick: () => {
                    updateVolSelected({ id_cotizacion: row.original.id_cotizacion, volumen: 'volumen' })
                }
            })
        }
    },
    {
        accessorKey: 'volumen_china',
        header: 'Vol. China',
        cell: ({ row }: { row: any }) => {
            return h(UBadge, {
                color: row.original.vol_selected === 'volumen_china' ? 'primary' : 'transparent',
                variant: 'solid',
                class: 'cursor-pointer text-black dark:text-white p-4',
                label: row.getValue('volumen_china'),
                onClick: () => {
                    updateVolSelected({ id_cotizacion: row.original.id_cotizacion, volumen: 'volumen_china' })
                }
            })
        }
    },
    {
        accessorKey: 'volumen_doc',
        header: 'Vol. Doc',
        cell: ({ row }: { row: any }) => {
            return h(UBadge, {
                color: row.original.vol_selected === 'volumen_doc' ? 'primary' : 'transparent',
                variant: 'solid',
                label: row.getValue('volumen_doc'),
                class: 'cursor-pointer text-black dark:text-white p-4',
                onClick: () => {
                    updateVolSelected({ id_cotizacion: row.original.id_cotizacion, volumen: 'volumen_doc' })
                }
            })
        }
    },
    {
        accessorKey: 'valor_cot',
        header: 'Valor Cot',
        cell: ({ row }: { row: any }) => {
            return row.getValue('valor_cot')
        }
    },
    {
        accessorKey: 'valor_doc',
        header: 'Valor Doc',
        cell: ({ row }: { row: any }) => {
            return row.getValue('valor_doc')
        }
    },
    {
        accessorKey: 'variacion',
        header: 'VariaciÃ³n',
        cell: ({ row }: { row: any }) => {
            //if volumen volumen china and volumen doc are different o valor cot and valor doc are different show badge with text SI else NO
            if (row.getValue('volumen') !== row.getValue('volumen_china') || row.getValue('volumen') !== row.getValue('volumen_doc') || row.getValue('valor_cot') !== row.getValue('valor_doc')) {
                return h(UBadge, {
                    label: 'SI',
                    color: 'primary',
                    variant: 'soft'
                })
            }
            return h(UBadge, {
                label: 'NO',
                color: 'neutral',
                variant: 'soft'
            })
        }
    }
])

const handleUpdateEstadoCliente = async (data: any) => {
    try {
        await withSpinner(async () => {
            const response = await updateEstadoCliente(data)
            if (response.success) {
                await getClientes(Number(id))
                showSuccess('ActualizaciÃ³n Exitosa', 'El estado del cliente se ha actualizado correctamente.')
            }
        }, 'Actualizando estado del cliente...')
    } catch (err) {
        error.value = err as string
    }
}
const updateVolSelected = async (data: any) => {
    try {
        showConfirmation(
            'Confirmar actualizaciÃ³n',
            'Â¿EstÃ¡ seguro de que desea actualizar el volumen seleccionado? Esta acciÃ³n no se puede deshacer.',
            async () => {
                try {
                    await withSpinner(async () => {
                        const response = await updateVolumenSelected(data)
                        if (response.success) {
                            await getClientesVariacion(Number(id))
                            showSuccess('ActualizaciÃ³n Exitosa', 'El volumen seleccionado se ha actualizado correctamente.')
                        }
                    }, 'Actualizando volumen seleccionado...')
                } catch (error) {
                    console.error('Error al actualizar el volumen seleccionado:', error)
                    showError('Error de ActualizaciÃ³n', 'Error al actualizar el volumen seleccionado')
                }
            }
        )
    } catch (err) {
        error.value = err as string
    }
}
onMounted(() => {
    if (currentRole.value === ROLES.DOCUMENTACION) {
        tabs.value = [
            {
                label: 'General',
                value: 'general'
            }
        ]
    }
    else if (currentRole.value === ROLES.COORDINACION || (currentRole.value === ROLES.COTIZADOR && currentId.value == ID_JEFEVENTAS)) {
        tabs.value = [
            {
                label: 'General',
                value: 'general'
            },
            {
                label: 'VariaciÃ³n',
                value: 'variacion'
            },
            {
                label: 'Pagos',
                value: 'pagos'
            }
        ]
    } else {
        tabs.value = [
            {
                label: 'General',
                value: 'general'
            },
            {
                label: 'VariaciÃ³n',
                value: 'variacion'
            }
        ]
    }
    handleTabChange(tab.value)
})
watch(() => tab.value, async (newVal) => {
    if (newVal && newVal !== '') {
        try {
            if (newVal === 'general') {
                navigateTo(`/cargaconsolidada/abiertos/clientes/${id}?tab=general`)
                await getClientes(Number(id))
            } else if (newVal === 'variacion') {
                navigateTo(`/cargaconsolidada/abiertos/clientes/${id}?tab=variacion`)
                await getClientesVariacion(Number(id))
            } else if (newVal === 'pagos') {
                navigateTo(`/cargaconsolidada/abiertos/clientes/${id}?tab=pagos`)
                await getClientesPagos(Number(id))
            }
            await getHeaders(Number(id))
            //implements getHeaders
        } catch (error) {
            console.error('Error en carga inicial:', error)
        }
    }
}, { immediate: true })
</script>